<!DOCTYPE html>
<html>
<head>
    <title>3D Racing Game - –ì–∏–≥–∞–Ω—Ç—Å–∫–∞—è –ö–∞—Ä—Ç–∞!</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            color: white;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            touch-action: none;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        /* –≠–ö–†–ê–ù –í–´–ë–û–†–ê –ú–ê–®–ò–ù–´ */
        #carSelect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .car-btn {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            border: 3px solid #e74c3c;
            color: white;
            padding: 20px;
            margin: 10px;
            border-radius: 15px;
            cursor: pointer;
            width: 300px;
            font-size: 18px;
            transition: all 0.3s;
            text-align: center;
        }
        
        .car-btn:hover {
            transform: scale(1.05);
            border-color: #f39c12;
            background: linear-gradient(45deg, #e74c3c, #f39c12);
        }
        
        /* –ò–ì–†–û–í–û–ô –ò–ù–¢–ï–†–§–ï–ô–° */
        #gameUI {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e74c3c;
            z-index: 100;
            display: none;
        }
        
        .stats {
            margin: 8px 0;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .speed { color: #3498db; }
        .lap { color: #2ecc71; }
        .position { color: #f39c12; }
        
        /* –ú–û–ë–ò–õ–¨–ù–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï - –ú–ê–õ–ï–ù–¨–ö–ò–ï –ö–ù–û–ü–ö–ò */
        #mobileControls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: none;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
            align-items: center;
        }
        
        .control-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }
        
        .arrow-btn {
            width: 60px;
            height: 60px;
            background: rgba(52, 152, 219, 0.3);
            border: 2px solid #3498db;
            border-radius: 15px;
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .arrow-btn:active {
            background: rgba(52, 152, 219, 0.6);
            transform: scale(0.95);
        }
        
        .arrow-row {
            display: flex;
            gap: 15px;
        }
        
        .action-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            color: white;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid;
            transition: all 0.2s;
        }
        
        .action-btn:active {
            transform: scale(0.95);
        }
        
        #nitroBtn {
            background: rgba(155, 89, 182, 0.3);
            border-color: #9b59b6;
        }
        
        #brakeBtn {
            background: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
        }
        
        #cameraRotateArea {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 70%;
            z-index: 50;
            display: none;
        }
        
        #carHUD {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            padding: 12px 20px;
            border-radius: 12px;
            border: 2px solid #e74c3c;
            display: none;
            font-size: 16px;
        }

        .title {
            font-size: 2.5em;
            background: linear-gradient(45deg, #e74c3c, #f39c12);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
        }

        .subtitle {
            font-size: 1.3em;
            color: #bdc3c7;
            margin-bottom: 30px;
        }

        /* –ú–ò–ù–ò-–ö–ê–†–¢–ê */
        #miniMap {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 120px;
            height: 120px;
            background: rgba(0,0,0,0.7);
            border: 2px solid #3498db;
            border-radius: 8px;
            display: none;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <!-- –û–ë–õ–ê–°–¢–¨ –ü–û–í–û–†–û–¢–ê –ö–ê–ú–ï–†–´ -->
        <div id="cameraRotateArea"></div>
        
        <!-- –í–´–ë–û–† –ú–ê–®–ò–ù–´ -->
        <div id="carSelect">
            <h1 class="title">üöó 3D RACING GIANT MAP üèÅ</h1>
            <h2 class="subtitle">–í—ã–±–µ—Ä–∏ —Å–≤–æ—é —Ç–∞—á–∫—É:</h2>
            
            <button class="car-btn" onclick="selectCar('bmw')">
                üöô BMW X5<br>
                <small>–°–∫–æ—Ä–æ—Å—Ç—å: 250 –∫–º/—á | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –û—Ç–ª–∏—á–Ω–æ–µ</small>
            </button>
            
            <button class="car-btn" onclick="selectCar('mercedes')">
                üöó Mercedes G-Class<br>
                <small>–°–∫–æ—Ä–æ—Å—Ç—å: 250 –∫–º/—á | –ü—Ä–æ—Ö–æ–¥–∏–º–æ—Å—Ç—å: –í—ã—Å–æ–∫–∞—è</small>
            </button>
            
            <button class="car-btn" onclick="selectCar('audi')">
                üèéÔ∏è Audi R8<br>
                <small>–°–∫–æ—Ä–æ—Å—Ç—å: 250 –∫–º/—á | –£—Å–∫–æ—Ä–µ–Ω–∏–µ: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ</small>
            </button>
            
            <button style="
                background: linear-gradient(45deg, #e74c3c, #f39c12);
                color: white;
                border: none;
                padding: 20px 40px;
                border-radius: 15px;
                font-size: 20px;
                margin-top: 30px;
                cursor: pointer;
                border: 2px solid #fff;
                font-weight: bold;
            " onclick="startGame()">üèÅ –ù–ê–ß–ê–¢–¨ –ì–û–ù–ö–£!</button>
        </div>
        
        <!-- –ò–ì–†–û–í–û–ô –ò–ù–¢–ï–†–§–ï–ô–° -->
        <div id="gameUI">
            <div class="stats">üöÄ <span id="speed" class="speed">0</span> –∫–º/—á</div>
            <div class="stats">üèÅ <span id="lap" class="lap">1</span>/3 –∫—Ä—É–≥</div>
            <div class="stats">üìä <span id="position" class="position">1-–µ –º–µ—Å—Ç–æ</span></div>
        </div>

        <!-- –ú–ò–ù–ò-–ö–ê–†–¢–ê -->
        <div id="miniMap"></div>
        
        <div id="carHUD">
            <span id="carName">BMW X5</span> | 
            <span id="carNitro">üí® 100%</span>
        </div>
        
        <!-- –ú–û–ë–ò–õ–¨–ù–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï - –ú–ê–õ–ï–ù–¨–ö–ò–ï –°–¢–†–ï–õ–ö–ò -->
        <div id="mobileControls">
            <div class="control-section">
                <div class="arrow-row">
                    <div class="arrow-btn" id="forwardBtn">‚Üë</div>
                </div>
                <div class="arrow-row">
                    <div class="arrow-btn" id="leftBtn">‚Üê</div>
                    <div style="width: 60px; height: 60px;"></div>
                    <div class="arrow-btn" id="rightBtn">‚Üí</div>
                </div>
                <div class="arrow-row">
                    <div class="arrow-btn" id="backwardBtn">‚Üì</div>
                </div>
            </div>
            
            <div class="control-section">
                <div class="action-btn" id="nitroBtn">üí®</div>
                <div class="action-btn" id="brakeBtn">üõë</div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ú–ê–®–ò–ù
        const cars = {
            bmw: { 
                name: "BMW X5", 
                maxSpeed: 250, // –£–í–ï–õ–ò–ß–ò–õ–ò –î–û 250!
                acceleration: 0.06,
                handling: 0.03,
                color: 0x0066cc,
                scale: 1.2
            },
            mercedes: { 
                name: "Mercedes G-Class", 
                maxSpeed: 250, // –£–í–ï–õ–ò–ß–ò–õ–ò –î–û 250!
                acceleration: 0.05,
                handling: 0.025,
                color: 0x000000,
                scale: 1.3
            },
            audi: { 
                name: "Audi R8", 
                maxSpeed: 250, // –£–í–ï–õ–ò–ß–ò–õ–ò –î–û 250!
                acceleration: 0.08,
                handling: 0.035,
                color: 0xff0000,
                scale: 1.0
            }
        };

        // –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´
        let scene, camera, renderer;
        let carModel, track, opponents = [];
        let currentCar = 'bmw';
        let gameActive = false;
        let carSpeed = 0;
        let currentLap = 1;
        let totalLaps = 3;
        let playerPosition = 1;
        let nitro = 100;
        
        // –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–¢–†–ï–õ–ö–ê–ú–ò
        let controls = { 
            forward: false, 
            backward: false, 
            left: false, 
            right: false,
            nitro: false, 
            brake: false 
        };

        // –ü–û–í–û–†–û–¢ –ö–ê–ú–ï–†–´
        let cameraRotation = {
            active: false,
            startX: 0,
            startY: 0,
            currentX: 0,
            currentY: 0,
            sensitivity: 0.01
        };

        // –†–ê–ó–ú–ï–†–´ –ö–ê–†–¢–´ (–ì–ò–ì–ê–ù–¢–°–ö–ò–ï - 10000x10000!)
        const MAP_SIZE = 10000;
        const TRACK_WIDTH = 200;

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø THREE.JS
        function initGame() {
            console.log("üöó –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è 3D –≥–æ–Ω–æ—á–Ω–æ–π –∏–≥—Ä—ã —Å –ì–ò–ì–ê–ù–¢–°–ö–û–ô –∫–∞—Ä—Ç–æ–π...");
            
            // –°–û–ó–î–ê–ï–ú –°–¶–ï–ù–£
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.Fog(0x87CEEB, 1000, 5000);
            
            // –ö–ê–ú–ï–†–ê - –≤–∏–¥ –æ—Ç —Ç—Ä–µ—Ç—å–µ–≥–æ –ª–∏—Ü–∞
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000);
            camera.position.set(0, 20, 30);
            
            // –†–ï–ù–î–ï–†–ï–†
            renderer = new THREE.WebGLRenderer({ 
                canvas: document.getElementById('gameCanvas'), 
                antialias: true 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            // –û–°–í–ï–©–ï–ù–ò–ï
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);
            directionalLight.position.set(5000, 10000, 5000);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // –°–û–ó–î–ê–ï–ú –ì–ò–ì–ê–ù–¢–°–ö–£–Æ –¢–†–ê–°–°–£ –ò –û–ö–†–£–ñ–ï–ù–ò–ï
            createGiantTrack();
            createGiantEnvironment();
            
            console.log("‚úÖ 3D –≥–æ–Ω–æ—á–Ω–∞—è –∏–≥—Ä–∞ —Å –ì–ò–ì–ê–ù–¢–°–ö–û–ô –∫–∞—Ä—Ç–æ–π –≥–æ—Ç–æ–≤–∞!");
        }

        function createGiantTrack() {
            // –ì–ò–ì–ê–ù–¢–°–ö–û–ï –ü–û–õ–û–¢–ù–û –¢–†–ê–°–°–´
            const trackGeometry = new THREE.PlaneGeometry(MAP_SIZE, MAP_SIZE);
            const trackMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x228B22,
                roughness: 0.9
            });
            track = new THREE.Mesh(trackGeometry, trackMaterial);
            track.rotation.x = -Math.PI / 2;
            track.receiveShadow = true;
            scene.add(track);

            // –ê–°–§–ê–õ–¨–¢–û–í–ê–Ø –î–û–†–û–ì–ê
            const roadGeometry = new THREE.PlaneGeometry(TRACK_WIDTH, MAP_SIZE);
            const roadMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x333333,
                roughness: 0.7
            });
            const road = new THREE.Mesh(roadGeometry, roadMaterial);
            road.rotation.x = -Math.PI / 2;
            road.position.y = 0.01;
            road.receiveShadow = true;
            scene.add(road);

            // –†–ê–ó–ú–ï–¢–ö–ê –î–û–†–û–ì–ò
            const lineGeometry = new THREE.PlaneGeometry(3, 30);
            const lineMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
            
            // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø—Ä–µ—Ä—ã–≤–∏—Å—Ç–∞—è –ª–∏–Ω–∏—è
            for (let z = -MAP_SIZE/2; z <= MAP_SIZE/2; z += 60) {
                const line = new THREE.Mesh(lineGeometry, lineMaterial);
                line.rotation.x = -Math.PI / 2;
                line.position.set(0, 0.02, z);
                scene.add(line);
            }

            // –ë–û–†–î–Æ–†–´
            const curbGeometry = new THREE.BoxGeometry(TRACK_WIDTH + 20, 2, 8);
            const curbMaterial = new THREE.MeshLambertMaterial({ color: 0x666666 });
            
            const leftCurb = new THREE.Mesh(curbGeometry, curbMaterial);
            leftCurb.position.set(-TRACK_WIDTH/2 - 4, 1, 0);
            scene.add(leftCurb);
            
            const rightCurb = new THREE.Mesh(curbGeometry, curbMaterial);
            rightCurb.position.set(TRACK_WIDTH/2 + 4, 1, 0);
            scene.add(rightCurb);

            // –î–û–†–û–ñ–ù–ê–Ø –†–ê–ó–ú–ï–¢–ö–ê –ü–û –ë–û–ö–ê–ú
            const sideLineGeometry = new THREE.PlaneGeometry(1, MAP_SIZE);
            const sideLineMaterial = new THREE.MeshLambertMaterial({ color: 0xffff00 });
            
            const leftLine = new THREE.Mesh(sideLineGeometry, sideLineMaterial);
            leftLine.rotation.x = -Math.PI / 2;
            leftLine.position.set(-TRACK_WIDTH/2 + 5, 0.03, 0);
            scene.add(leftLine);
            
            const rightLine = new THREE.Mesh(sideLineGeometry, sideLineMaterial);
            rightLine.rotation.x = -Math.PI / 2;
            rightLine.position.set(TRACK_WIDTH/2 - 5, 0.03, 0);
            scene.add(rightLine);
        }

        function createGiantEnvironment() {
            // –û–ì–†–û–ú–ù–´–ï –ì–û–†–´
            const mountainGeometry = new THREE.ConeGeometry(500, 800, 16);
            const mountainMaterial = new THREE.MeshLambertMaterial({ color: 0x795548 });
            
            // –°–æ–∑–¥–∞–µ–º –≥–æ—Ä–Ω—ã–π —Ö—Ä–µ–±–µ—Ç –ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É –∫–∞—Ä—Ç—ã
            const mountainPositions = [
                { x: -4000, z: -4000 }, { x: -2000, z: -4500 }, { x: 0, z: -4800 },
                { x: 2000, z: -4500 }, { x: 4000, z: -4000 }, { x: 4500, z: -2000 },
                { x: 4800, z: 0 }, { x: 4500, z: 2000 }, { x: 4000, z: 4000 },
                { x: 2000, z: 4500 }, { x: 0, z: 4800 }, { x: -2000, z: 4500 },
                { x: -4000, z: 4000 }, { x: -4500, z: 2000 }, { x: -4800, z: 0 },
                { x: -4500, z: -2000 }
            ];
            
            mountainPositions.forEach(pos => {
                const mountain = new THREE.Mesh(mountainGeometry, mountainMaterial);
                mountain.position.set(pos.x, 400, pos.z);
                mountain.rotation.y = Math.random() * Math.PI;
                scene.add(mountain);
            });

            // –û–ì–†–û–ú–ù–´–ô –õ–ï–°
            const treeTrunkGeometry = new THREE.CylinderGeometry(3, 4, 20, 8);
            const treeTrunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            const treeLeavesGeometry = new THREE.SphereGeometry(12);
            const treeLeavesMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
            
            // –°–æ–∑–¥–∞–µ–º –û–ß–ï–ù–¨ –º–Ω–æ–≥–æ –¥–µ—Ä–µ–≤—å–µ–≤
            for (let i = 0; i < 300; i++) {
                const treeTrunk = new THREE.Mesh(treeTrunkGeometry, treeTrunkMaterial);
                const treeLeaves = new THREE.Mesh(treeLeavesGeometry, treeLeavesMaterial);
                
                const side = Math.random() > 0.5 ? 1 : -1;
                const x = side * (TRACK_WIDTH/2 + 100 + Math.random() * 1000);
                const z = (Math.random() - 0.5) * MAP_SIZE;
                
                treeTrunk.position.set(x, 10, z);
                treeLeaves.position.set(x, 25, z);
                
                treeTrunk.castShadow = true;
                treeLeaves.castShadow = true;
                
                scene.add(treeTrunk);
                scene.add(treeLeaves);
            }

            // –ë–û–õ–¨–®–ò–ï –ó–î–ê–ù–ò–Ø
            const buildingGeometry = new THREE.BoxGeometry(80, 150, 80);
            const buildingMaterial = new THREE.MeshLambertMaterial({ color: 0x95a5a6 });
            
            for (let i = 0; i < 50; i++) {
                const building = new THREE.Mesh(buildingGeometry, buildingMaterial);
                const side = Math.random() > 0.5 ? 1 : -1;
                const x = side * (TRACK_WIDTH/2 + 300 + Math.random() * 1500);
                const z = (Math.random() - 0.5) * MAP_SIZE;
                
                building.position.set(x, 75, z);
                building.castShadow = true;
                scene.add(building);
            }

            // –û–°–í–ï–©–ï–ù–ò–ï –ò –°–¢–û–õ–ë–´ –í–î–û–õ–¨ –¢–†–ê–°–°–´
            const lampPostGeometry = new THREE.CylinderGeometry(2, 2, 40, 8);
            const lampPostMaterial = new THREE.MeshLambertMaterial({ color: 0x34495e });
            const lampGeometry = new THREE.SphereGeometry(5);
            const lampMaterial = new THREE.MeshLambertMaterial({ color: 0xf1c40f });
            
            for (let z = -MAP_SIZE/2; z <= MAP_SIZE/2; z += 200) {
                const lampPost = new THREE.Mesh(lampPostGeometry, lampPostMaterial);
                const lamp = new THREE.Mesh(lampGeometry, lampMaterial);
                
                lampPost.position.set(TRACK_WIDTH/2 + 15, 20, z);
                lamp.position.set(TRACK_WIDTH/2 + 15, 40, z);
                
                scene.add(lampPost);
                scene.add(lamp);
                
                // –°—Ç–æ–ª–±—ã —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
                const lampPost2 = new THREE.Mesh(lampPostGeometry, lampPostMaterial);
                const lamp2 = new THREE.Mesh(lampGeometry, lampMaterial);
                
                lampPost2.position.set(-TRACK_WIDTH/2 - 15, 20, z);
                lamp2.position.set(-TRACK_WIDTH/2 - 15, 40, z);
                
                scene.add(lampPost2);
                scene.add(lamp2);
            }

            // –û–ó–ï–†–ê –ò –í–û–î–û–ï–ú–´
            const lakeGeometry = new THREE.PlaneGeometry(500, 300);
            const lakeMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x2980b9,
                transparent: true,
                opacity: 0.7
            });
            
            for (let i = 0; i < 10; i++) {
                const lake = new THREE.Mesh(lakeGeometry, lakeMaterial);
                const side = Math.random() > 0.5 ? 1 : -1;
                const x = side * (TRACK_WIDTH/2 + 600 + Math.random() * 2000);
                const z = (Math.random() - 0.5) * MAP_SIZE;
                
                lake.rotation.x = -Math.PI / 2;
                lake.position.set(x, 0.05, z);
                scene.add(lake);
            }
        }

        // –°–û–ó–î–ê–ù–ò–ï 3D –ú–û–î–ï–õ–ò –ú–ê–®–ò–ù–´
        function createCarModel(carType) {
            console.log(`üöó –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω—ã: ${carType}`);
            
            if (carModel) scene.remove(carModel);
            
            const carConfig = cars[carType];
            const carGroup = new THREE.Group();
            
            // –ö–£–ó–û–í
            const bodyGeometry = new THREE.BoxGeometry(3, 1, 6);
            const bodyMaterial = new THREE.MeshLambertMaterial({ 
                color: carConfig.color,
                roughness: 0.3,
                metalness: 0.7
            });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.castShadow = true;
            carGroup.add(body);

            // –ö–ê–ë–ò–ù–ê
            const cabinGeometry = new THREE.BoxGeometry(2.5, 1, 2);
            const cabinMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x222222,
                transparent: true,
                opacity: 0.8
            });
            const cabin = new THREE.Mesh(cabinGeometry, cabinMaterial);
            cabin.position.set(0, 1.2, -0.5);
            cabin.castShadow = true;
            carGroup.add(cabin);

            // –ö–û–õ–ï–°–ê
            const wheelGeometry = new THREE.CylinderGeometry(0.6, 0.6, 0.4, 16);
            const wheelMaterial = new THREE.MeshLambertMaterial({ color: 0x111111 });
            
            const wheelPositions = [
                { x: -1.5, y: -0.5, z: 1.8 }, { x: 1.5, y: -0.5, z: 1.8 },
                { x: -1.5, y: -0.5, z: -1.8 }, { x: 1.5, y: -0.5, z: -1.8 }
            ];
            
            wheelPositions.forEach(pos => {
                const wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
                wheel.position.set(pos.x, pos.y, pos.z);
                wheel.rotation.z = Math.PI / 2;
                wheel.castShadow = true;
                carGroup.add(wheel);
            });

            carModel = carGroup;
            carModel.scale.set(carConfig.scale, carConfig.scale, carConfig.scale);
            scene.add(carModel);

            console.log("‚úÖ –ú–∞—à–∏–Ω–∞ —Å–æ–∑–¥–∞–Ω–∞!");
        }

        function createOpponents() {
            const opponentColors = [0xff4444, 0x44ff44, 0x4444ff, 0xffff44];
            
            for (let i = 0; i < 4; i++) {
                const opponentGroup = new THREE.Group();
                
                const bodyGeometry = new THREE.BoxGeometry(3, 1, 6);
                const bodyMaterial = new THREE.MeshLambertMaterial({ 
                    color: opponentColors[i],
                    roughness: 0.3
                });
                const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
                opponentGroup.add(body);

                opponentGroup.position.set(
                    (Math.random() - 0.5) * 30,
                    1.5,
                    -80 - i * 50
                );
                
                opponents.push({
                    model: opponentGroup,
                    speed: 60 + Math.random() * 40,
                    lap: 1
                });
                
                scene.add(opponentGroup);
            }
        }

        function selectCar(car) {
            currentCar = car;
            console.log(`üöó –í—ã–±—Ä–∞–Ω–∞: ${cars[car].name}`);
        }

        function startGame() {
            console.log("üèÅ –ó–∞–ø—É—Å–∫ –≥–æ–Ω–∫–∏ –Ω–∞ –ì–ò–ì–ê–ù–¢–°–ö–û–ô –∫–∞—Ä—Ç–µ...");
            
            document.getElementById('carSelect').style.display = 'none';
            document.getElementById('gameUI').style.display = 'block';
            document.getElementById('carHUD').style.display = 'block';
            document.getElementById('mobileControls').style.display = 'flex';
            document.getElementById('miniMap').style.display = 'block';
            document.getElementById('cameraRotateArea').style.display = 'block';
            
            createCarModel(currentCar);
            createOpponents();
            setupMobileControls();
            setupCameraRotation();
            
            gameActive = true;
            updateUI();
            animate();
        }

        // –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–¢–†–ï–õ–ö–ê–ú–ò
        function setupMobileControls() {
            // –°–¢–†–ï–õ–ö–ò –î–í–ò–ñ–ï–ù–ò–Ø
            document.getElementById('forwardBtn').addEventListener('touchstart', (e) => {
                e.preventDefault(); controls.forward = true;
            });
            document.getElementById('forwardBtn').addEventListener('touchend', () => {
                controls.forward = false;
            });
            
            document.getElementById('backwardBtn').addEventListener('touchstart', (e) => {
                e.preventDefault(); controls.backward = true;
            });
            document.getElementById('backwardBtn').addEventListener('touchend', () => {
                controls.backward = false;
            });
            
            document.getElementById('leftBtn').addEventListener('touchstart', (e) => {
                e.preventDefault(); controls.left = true;
            });
            document.getElementById('leftBtn').addEventListener('touchend', () => {
                controls.left = false;
            });
            
            document.getElementById('rightBtn').addEventListener('touchstart', (e) => {
                e.preventDefault(); controls.right = true;
            });
            document.getElementById('rightBtn').addEventListener('touchend', () => {
                controls.right = false;
            });
            
            // –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô
            document.getElementById('nitroBtn').addEventListener('touchstart', (e) => {
                e.preventDefault(); 
                if (nitro > 0) controls.nitro = true;
            });
            document.getElementById('nitroBtn').addEventListener('touchend', () => {
                controls.nitro = false;
            });
            
            document.getElementById('brakeBtn').addEventListener('touchstart', (e) => {
                e.preventDefault(); controls.brake = true;
            });
            document.getElementById('brakeBtn').addEventListener('touchend', () => {
                controls.brake = false;
            });
        }

        // –ü–û–í–û–†–û–¢ –ö–ê–ú–ï–†–´ –ü–ê–õ–¨–¶–ï–ú
        function setupCameraRotation() {
            const cameraArea = document.getElementById('cameraRotateArea');
            
            cameraArea.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (e.touches.length === 1) {
                    cameraRotation.active = true;
                    cameraRotation.startX = e.touches[0].clientX;
                    cameraRotation.startY = e.touches[0].clientY;
                }
            });
            
            cameraArea.addEventListener('touchmove', (e) => {
                if (!cameraRotation.active || e.touches.length !== 1) return;
                e.preventDefault();
                
                cameraRotation.currentX = e.touches[0].clientX;
                cameraRotation.currentY = e.touches[0].clientY;
                
                const deltaX = (cameraRotation.currentX - cameraRotation.startX) * cameraRotation.sensitivity;
                const deltaY = (cameraRotation.currentY - cameraRotation.startY) * cameraRotation.sensitivity;
                
                // –ü–æ–≤–æ—Ä–æ—Ç –∫–∞–º–µ—Ä—ã –≤–æ–∫—Ä—É–≥ –º–∞—à–∏–Ω—ã
                camera.rotation.y -= deltaX;
                camera.rotation.x = THREE.MathUtils.clamp(camera.rotation.x - deltaY, -Math.PI/3, Math.PI/6);
                
                cameraRotation.startX = cameraRotation.currentX;
                cameraRotation.startY = cameraRotation.currentY;
            });
            
            cameraArea.addEventListener('touchend', () => {
                cameraRotation.active = false;
            });
        }

        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ì–†–´
        function updateGame() {
            if (!gameActive) return;
            
            const carConfig = cars[currentCar];
            
            // –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ö–û–†–û–°–¢–¨–Æ –°–¢–†–ï–õ–ö–ê–ú–ò
            if (controls.forward) {
                carSpeed = Math.min(carConfig.maxSpeed, carSpeed + carConfig.acceleration * 2);
            } else if (controls.backward) {
                carSpeed = Math.max(-carConfig.maxSpeed * 0.5, carSpeed - carConfig.acceleration * 3);
            } else {
                // –ü–ª–∞–≤–Ω–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ
                carSpeed *= 0.98;
            }
            
            // –¢–û–†–ú–û–ñ–ï–ù–ò–ï
            if (controls.brake) {
                carSpeed = Math.max(0, carSpeed - carConfig.acceleration * 4);
            }
            
            // NITRO
            if (controls.nitro && nitro > 0) {
                carSpeed = Math.min(carConfig.maxSpeed * 1.3, carSpeed + carConfig.acceleration * 3);
                nitro = Math.max(0, nitro - 0.8);
            }
            
            // –ü–û–í–û–†–û–¢–´ –°–¢–†–ï–õ–ö–ê–ú–ò
            if (Math.abs(carSpeed) > 5) {
                if (controls.left) {
                    carModel.rotation.y += carConfig.handling * (carSpeed / carConfig.maxSpeed);
                }
                if (controls.right) {
                    carModel.rotation.y -= carConfig.handling * (carSpeed / carConfig.maxSpeed);
                }
            }
            
            // –î–í–ò–ñ–ï–ù–ò–ï –ú–ê–®–ò–ù–´
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(carModel.quaternion);
            carModel.position.add(direction.multiplyScalar(carSpeed * 0.02));
            
            // –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –ì–†–ê–ù–ò–¶ –ö–ê–†–¢–´
            carModel.position.x = THREE.MathUtils.clamp(carModel.position.x, -MAP_SIZE/2, MAP_SIZE/2);
            carModel.position.z = THREE.MathUtils.clamp(carModel.position.z, -MAP_SIZE/2, MAP_SIZE/2);
            
            // –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï NITRO
            if (!controls.nitro && nitro < 100) {
                nitro += 0.1;
            }
            
            // –ö–ê–ú–ï–†–ê –°–õ–ï–î–ò–¢ –ó–ê –ú–ê–®–ò–ù–û–ô (–µ—Å–ª–∏ –Ω–µ –≤—Ä–∞—â–∞–µ–º –≤—Ä—É—á–Ω—É—é)
            if (!cameraRotation.active) {
                const cameraDistance = 25;
                const cameraHeight = 15;
                
                // –ü–ª–∞–≤–Ω–æ–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∫–∞–º–µ—Ä—ã –∑–∞ –º–∞—à–∏–Ω–æ–π
                const targetCameraPos = new THREE.Vector3(
                    carModel.position.x,
                    carModel.position.y + cameraHeight,
                    carModel.position.z + cameraDistance
                );
                
                camera.position.lerp(targetCameraPos, 0.1);
                camera.lookAt(carModel.position);
            }
            
            updateOpponents();
            updateUI();
        }

        function updateOpponents() {
            opponents.forEach((opponent, index) => {
                const oppDirection = new THREE.Vector3(0, 0, -1);
                opponent.model.position.add(oppDirection.multiplyScalar(opponent.speed * 0.02));
                
                // –ü—Ä–æ—Å—Ç–æ–π –ò–ò –¥–ª—è –æ–ø–ø–æ–Ω–µ–Ω—Ç–æ–≤
                opponent.model.rotation.y += (Math.sin(Date.now() * 0.001 + index) * 0.01);
                
                // –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Ç—Ä–∞—Å—Å—É
                if (opponent.model.position.x < -TRACK_WIDTH/2 || opponent.model.position.x > TRACK_WIDTH/2) {
                    opponent.model.rotation.y += Math.PI * 0.02;
                }
                
                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü
                opponent.model.position.x = THREE.MathUtils.clamp(opponent.model.position.x, -MAP_SIZE/2, MAP_SIZE/2);
                opponent.model.position.z = THREE.MathUtils.clamp(opponent.model.position.z, -MAP_SIZE/2, MAP_SIZE/2);
            });
        }

        function updateUI() {
            document.getElementById('speed').textContent = Math.round(Math.abs(carSpeed));
            document.getElementById('lap').textContent = `${currentLap}/${totalLaps}`;
            document.getElementById('position').textContent = `${playerPosition}-–µ –º–µ—Å—Ç–æ`;
            document.getElementById('carName').textContent = cars[currentCar].name;
            document.getElementById('carNitro').textContent = `üí® ${Math.round(nitro)}%`;
        }

        // –ê–ù–ò–ú–ê–¶–ò–Ø
        function animate() {
            if (!gameActive) return;
            
            requestAnimationFrame(animate);
            updateGame();
            renderer.render(scene, camera);
        }

        // –ó–ê–ü–£–°–ö
        window.addEventListener('load', initGame);
        
        window.addEventListener('resize', () => {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        });

        console.log("üèéÔ∏è 3D –ì–æ–Ω–æ—á–Ω–∞—è –∏–≥—Ä–∞ —Å –ì–ò–ì–ê–ù–¢–°–ö–û–ô –∫–∞—Ä—Ç–æ–π –≥–æ—Ç–æ–≤–∞!");
    </script>
</body>
</html>